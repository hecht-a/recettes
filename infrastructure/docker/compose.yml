services:
    frontend:
        build:
            context: services/php
            target: frontend
        depends_on:
            - postgres
        volumes:
            - "../..:/var/www:cached"
        environment:
            - "PHP_VERSION=${PHP_VERSION}"
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.${PROJECT_NAME}-frontend.rule=Host(${PROJECT_DOMAINS})"
            - "traefik.http.routers.${PROJECT_NAME}-frontend.tls=true"
            - "traefik.http.routers.${PROJECT_NAME}-frontend-unsecure.rule=Host(${PROJECT_DOMAINS})"
            # Comment the next line to be able to access frontend via HTTP instead of HTTPS
            - "traefik.http.routers.${PROJECT_NAME}-frontend-unsecure.middlewares=redirect-to-https@file"
        networks:
            - app_network

    postgres:
        image: postgres:latest
        environment:
            POSTGRES_USER: recettes
            POSTGRES_PASSWORD: recettes
            POSTGRES_DB: recettes
        volumes:
            - db_data:/var/lib/postgresql/data
        networks:
            - app_network

volumes:
    db_data: {}

networks:
    app_network:
        driver: bridge
